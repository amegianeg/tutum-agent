{
	"variables": {
		"version": "dev"
	},
	"builders": [
		{
			"type": "virtualbox-ovf",
			"source_path": "staging/box.ovf",
			"guest_additions_mode": "disable",
			"headless": true,
			"ssh_username": "vagrant",
			"ssh_password": "vagrant",
			"shutdown_command": "sudo shutdown -h now"
		},
		{
			"type": "amazon-ebs",
			"region": "us-east-1",
			"source_ami": "ami-9eaa1cf6",
			"instance_type": "m3.medium",
			"ssh_username": "ubuntu",
			"ami_name": "tutum-node_{{timestamp}}",
			"ami_groups": ["all"],
			"tags": {
				"Name": "tutum-node_{{user `version`}}",
				"Version": "{{user `version`}}"
			},
			"ami_regions": ["us-west-1", "us-west-2", "eu-west-1", "sa-east-1", "ap-northeast-1", "ap-southeast-1", "ap-southeast-2"]
		}
	],
	"provisioners": [
		{
			"type": "shell",
			"inline": [
				"sudo apt-get update",
				"DEBIAN_FRONTEND=noninteractive sudo apt-get install -yq curl",
				"DEBIAN_FRONTEND=noninteractive curl -Ls https://files.tutum.co/scripts/install-agent-staging.sh | sudo sh"
			]
		}
	],
	"post-processors": [{
        "type": "vagrant",
        "output": "build/tutum-node_{{.Provider}}.box",
        "only": ["virtualbox-ovf"]
    }]
}